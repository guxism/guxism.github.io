<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>graph.h</title>
  <style>body{font-size:14px;line-height:24px;color:#252519;margin:0;padding:0;background:#f5f5ff}@media print{body #background{background:0 0;border:none}body div.docs{max-width:99%;padding-left:0;padding-right:0}body div.code{margin:0;clear:both}}@media screen and (max-width:1200px){body #background{background:0 0;border:none}body div.docs{max-width:99%}body div.code{padding-top:5px;margin:0;clear:both;background:#eee;border-top:1px solid #bbb;border-bottom:1px solid #bbb}}a{text-decoration:solid underline #261a3b 2px;font-size:14px;padding:0 .2em}p{margin:0 0 15px}#container{background:#fff}#container,div.section{position:relative}#background{top:0;right:0;bottom:0;background:#f5f5ff;border-left:1px solid #e5e5ee;z-index:0;position:absolute;height:100%;left:640px}#jump_page,#jump_to{background:#fff;-webkit-box-shadow:0 0 25px #777;-moz-box-shadow:0 0 25px #777;-webkit-border-bottom-left-radius:5px;-moz-border-radius-bottomleft:5px;font:10px Arial;text-transform:uppercase;cursor:pointer;text-align:right}#jump_to,#jump_wrapper{position:fixed;right:0;top:0;padding:5px 10px}#jump_wrapper{padding:0;display:none}#jump_to:hover #jump_wrapper{display:block}#jump_page{padding:5px 0 3px;margin:0 0 25px 25px}#jump_page .source{display:block;padding:5px 10px;text-decoration:none;border-top:1px solid #eee}#jump_page .source:hover{background:#f5f5ff}div.docs{float:left;max-width:500px;min-width:500px;min-height:5px;padding:10px 25px 1px 50px;vertical-align:top;text-align:left}div p img{max-width:500px;min-width:500px}.docs pre{margin:15px 0;padding-left:15px}.docs p code,.docs p tt{background:#f8f8ff;border:1px solid #dedede;font-size:12px;padding:0 .2em}.octowrap{position:relative}.octothorpe{font:12px Arial;text-decoration:none;color:#454545;position:absolute;top:3px;left:-20px;padding:1px 2px;opacity:0;-webkit-transition:opacity .2s linear}div.docs:hover .octothorpe{opacity:1}div.code{padding:14px 15px 16px 50px;vertical-align:top}.code pre,.docs p code{font-size:12px}code,pre,tt{line-height:18px;font-family:Monaco,Consolas,"Lucida Console",monospace;margin:0;padding:0}div.clearall{clear:both}td.linenos{background-color:#f0f0f0;padding-right:10px}span.lineno{background-color:#f0f0f0;padding:0 5px}body .hll{background-color:#ffc}body .c{color:#408080;font-style:italic}body .err{border:1px solid red}body .k{color:#954121;font-weight:700}body .o{color:#666}body .cm{color:#408080;font-style:italic}body .cp{color:#bc7a00}body .c1,body .cs{color:#408080;font-style:italic}body .gd{color:#a00000}body .ge{font-style:italic}body .gr{color:red}body .gh{color:navy;font-weight:700}body .gi{color:#00a000}body .go{color:grey}body .gp{color:navy;font-weight:700}body .gs{font-weight:700}body .gu{color:purple;font-weight:700}body .gt{color:#0040d0}body .kc{color:#954121}body .kd,body .kn{color:#954121;font-weight:700}body .kp{color:#954121}body .kr{color:#954121;font-weight:700}body .kt{color:#b00040}body .m{color:#666}body .s{color:#219161}body .na{color:#7d9029}body .nb{color:#954121}body .nc{color:#00f;font-weight:700}body .no{color:#800}body .nd{color:#a2f}body .ni{color:#999;font-weight:700}body .ne{color:#d2413a;font-weight:700}body .nf{color:#00f}body .nl{color:#a0a000}body .nn{color:#00f;font-weight:700}body .nt{color:#954121;font-weight:700}body .nv{color:#19469d}body .ow{color:#a2f;font-weight:700}body .w{color:#bbb}body .sb,body .sc{color:#219161}body .sd{color:#219161;font-style:italic}body .s2{color:#219161}body .se{color:#b62;font-weight:700}body .sh{color:#219161}body .si{color:#b68;font-weight:700}body .sx{color:#954121}body .sr{color:#b68}body .s1{color:#219161}body .ss{color:#19469d}body .bp{color:#954121}body .vc,body .vg,body .vi{color:#19469d}@font-face{font-family:aller-light;src:url(/fonts/aller-light.woff) format("woff");font-weight:400;font-style:normal}body{font-family:aller-light,sans-serif;position:relative;display:inline-block;min-height:100%;min-width:100%}h1,h2,h3,h4,h5,h6{margin:20px 0 15px;line-height:1.1em}div.docs{max-width:580px;padding-left:35px}div.code{margin-left:640px;padding-top:30px;padding-bottom:3px}div.docs p{margin-bottom:5px}body .kd{font-weight:400}body .n{color:#19469d}body .il,body .mf,body .mh,body .mi,body .mo{color:#40a070}table{border-collapse:collapse;border:2px solid #c8c8c8;letter-spacing:1px;font-size:.8rem}td,th{border:1px solid #bebebe;padding:10px 20px}th{background-color:#ebebeb}td{text-align:left}caption{padding:10px}blockquote{font-size:13px;color:#353131}</style><meta name="viewport" content="width=device-width">
</head>
<body>
<div id="container">
  <div id="background"></div>
  <!-- empty code block -->
  <div class="clearall">
  <div class="section" id="section-0">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-0">#</a>
      </div>
      <h1>图算法</h1>
<p>此头文件(更新中)通过 <a href="https://github.com/yhirose/cpp-peglib">cpp-peglib</a> 解析
graphviz dot 文件, 实现各种图算法, 提供结果可视化</p>
<p>关于 cpp-peglib:</p>
<ul>
<li><a href="https://github.com/yhirose/fizzbuzzlang/blob/master/fzbz.cc">Demo:
fizzbuzz</a></li>
<li><a href="https://yhirose.github.io/cpp-peglib/">PEG Playground</a></li>
</ul>
<p>源码: <a href="raw/graph.h">graph.h</a></p>
<p>测试文件:</p>
<ul>
<li><a href="raw/tree.cpp">tree.cpp</a></li>
</ul>
<p>效果:</p>
<p><img alt="" src="/images/tree-traversal.png"></p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span></span><span class="cp">#ifndef GRAPH2</span>
<span class="cp">#define GRAPH2</span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-1">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-1">#</a>
      </div>
      <p>依赖:
<a href="https://raw.githubusercontent.com/yhirose/cpp-peglib/master/peglib.h">peglib.h</a></p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="cp">#include</span><span class="w"> </span><span class="cpf">"peglib.h"</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;any&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstddef&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;regex&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;set&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;variant&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="n">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">udl</span><span class="p">;</span><span class="w"></span>

<span class="n">namespace</span><span class="w"> </span><span class="n">graph</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="n">using</span><span class="w"> </span><span class="n">KV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="n">using</span><span class="w"> </span><span class="n">Map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-2">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-2">#</a>
      </div>
      <p>使用算法导论中的着色思想</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="k">enum</span><span class="w"> </span><span class="n">color</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">WHITE</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">GREY</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">BLACK</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Attrs</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Map</span><span class="w"> </span><span class="n">attrs</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Vertex</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">dist</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="n">color</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-3">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-3">#</a>
      </div>
      <p>The time when this vertex gets gray</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">gray_time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">black_time</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-4">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-4">#</a>
      </div>
      <p>打印的时候需要用另外一个颜色变量避免污染算法的着色</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="n">pcolor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">prev</span><span class="p">(</span><span class="n">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="s">""</span><span class="p">),</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="p">(</span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">),</span><span class="w"> </span><span class="n">gray_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">          </span><span class="n">black_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">pcolor</span><span class="p">(</span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">prev</span><span class="p">(</span><span class="n">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="p">(</span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">),</span><span class="w"> </span><span class="n">gray_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">          </span><span class="n">black_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">pcolor</span><span class="p">(</span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">prev</span><span class="p">(</span><span class="n">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">w</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="p">(</span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">),</span><span class="w"> </span><span class="n">gray_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">          </span><span class="n">black_time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">pcolor</span><span class="p">(</span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">turn_gray</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">time</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">GREY</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">gray_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">turn_black</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">time</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">BLACK</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">black_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Edge</span><span class="w"></span>
<span class="p">{</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-5">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-5">#</a>
      </div>
      <p>Only in this way can
 the attributes of a node be
 changed by multiple other vertices</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Edge</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">src</span><span class="p">(</span><span class="n">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">dest</span><span class="p">(</span><span class="n">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">weight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">using</span><span class="w"> </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Entry</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-6">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-6">#</a>
      </div>
      <p><img alt="" src="/images/graph-structure.png"></p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="k">struct</span><span class="w"> </span><span class="nc">Graph</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">adj_list</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KV</span><span class="o">&gt;</span><span class="w"> </span><span class="n">graph_attrs</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-7">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-7">#</a>
      </div>
      <p>digraph or graph</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Attrs</span><span class="o">&gt;</span><span class="w"> </span><span class="n">node_attrs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Attrs</span><span class="o">&gt;</span><span class="w"> </span><span class="n">node_decls</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-8">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-8">#</a>
      </div>
      <p>用来跟踪顺序, 以便按照原来的顺序输出</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entries</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">display</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">adj_list</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" "</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" "</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="nf">insert_vertex</span><span class="p">(</span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">v</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adj_list</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">adj_list</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span><span class="w"></span>
<span class="w">            </span><span class="n">adj_list</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">adj_list</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">].</span><span class="n">first</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">get_vertex</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">adj_list</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert_edge</span><span class="p">(</span><span class="n">Edge</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adj_list</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">adj_list</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">adj_list</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">].</span><span class="n">second</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iter_facit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">end</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adj_list</span><span class="p">[</span><span class="n">end</span><span class="p">].</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">do</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">iter</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">curr</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">ri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iter</span><span class="p">.</span><span class="n">rbegin</span><span class="p">();</span><span class="w"> </span><span class="n">ri</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">iter</span><span class="p">.</span><span class="n">rend</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">ri</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">ri</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" "</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-9">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-9">#</a>
      </div>
      <p>print_time 表示是否输出时间</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">print_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">os</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print_time</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">gray_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">black_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">")"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">quote</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">                                               </span><span class="kt">int</span><span class="w"> </span><span class="n">print_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">os</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-10">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-10">#</a>
      </div>
      <p>根据名字查找节点</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">adj_list</span><span class="p">)[</span><span class="n">name</span><span class="p">].</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print_time</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">gray_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">black_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">")"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">quote</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">compose_new_vertex_name_w</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                 </span><span class="kt">int</span><span class="w"> </span><span class="n">print_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">os</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-11">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-11">#</a>
      </div>
      <p>根据名字查找节点</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">adj_list</span><span class="p">)[</span><span class="n">name</span><span class="p">].</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print_time</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"["</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"]"</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">gray_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">black_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">")"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">quote</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">compose_node_attrs</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Attrs</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">node ["</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">prev</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"]"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">compose_node_decls</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Attrs</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"></span>
<span class="w">                </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"["</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">prev</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">attrs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"]"</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">compose_graph_attrs</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KV</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">cleanup_color</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">adj_list</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">set_all_dist_inf</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">adj_list</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">NodeStrPair</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Entry</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Entry</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">Entry</span><span class="p">(</span><span class="n">NodeStrPair</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">np_str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">NodeStrPair</span><span class="w"> </span><span class="n">np_str</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-12">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-12">#</a>
      </div>
      <p>Define the type of node’s value</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="k">struct</span><span class="w"> </span><span class="nc">Value</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">nullptr_t</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="p">,</span><span class="w"> </span><span class="n">Entry</span><span class="p">,</span><span class="w"> </span><span class="n">Graph</span><span class="p">,</span><span class="w"> </span><span class="n">KV</span><span class="p">,</span><span class="w"></span>
<span class="w">                 </span><span class="n">NodeStrPair</span><span class="p">,</span><span class="w"> </span><span class="n">Attrs</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">        </span><span class="n">v</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">g</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">Entry</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">NodeStrPair</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">KV</span><span class="w"> </span><span class="n">kv</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">kv</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">Map</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">explicit</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">Attrs</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="n">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">typename</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">try</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_variant_access</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="nf">std::runtime_error</span><span class="p">(</span><span class="s">"type error."</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">GRAMMAR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="s">"(</span>

<span class="n">DotFile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Spacing</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="n">EndOfFile</span><span class="w"></span>
<span class="n">Graph</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Keyword</span><span class="w"> </span><span class="n">Identifier</span><span class="w"> </span><span class="n">Body</span><span class="w"></span>
<span class="n">Body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPar</span><span class="w"> </span><span class="n">Entry</span><span class="o">*</span><span class="w"> </span><span class="n">RPar</span><span class="w"></span>
<span class="n">Entry</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">Node2Node</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">NodeAttr</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">GraphAttr</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">NodeDeclaration</span><span class="w"></span>

<span class="n">NodeAttr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="err">'</span><span class="n">node</span><span class="err">'</span><span class="w"> </span><span class="n">Spacing</span><span class="w"> </span><span class="n">LBox</span><span class="w"> </span><span class="n">KVs</span><span class="w"> </span><span class="n">RBox</span><span class="w"></span>
<span class="n">GraphAttr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GraphAttr1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">GraphAttr2</span><span class="w"></span>
<span class="n">GraphAttr1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="err">'</span><span class="n">graph</span><span class="err">'</span><span class="w"> </span><span class="n">Spacing</span><span class="w"> </span><span class="n">LBox</span><span class="w"> </span><span class="n">KVs</span><span class="w"> </span><span class="n">RBox</span><span class="w"></span>
<span class="n">GraphAttr2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Pair</span><span class="w"></span>

<span class="n">NodeDeclaration</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Identifier</span><span class="w"> </span><span class="p">(</span><span class="n">LBox</span><span class="w"> </span><span class="n">KVs</span><span class="w"> </span><span class="n">RBox</span><span class="p">)</span><span class="o">*</span><span class="w"></span>

<span class="n">Node2Node</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Identifier</span><span class="w"> </span><span class="n">Connector</span><span class="w"> </span><span class="n">Identifier</span><span class="w"> </span><span class="p">(</span><span class="n">EdgeAttrs</span><span class="p">)</span><span class="o">?</span><span class="w"></span>

<span class="n">Connector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">Line</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Arrow</span><span class="p">)</span><span class="w"> </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">EdgeAttrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LBox</span><span class="w"> </span><span class="n">KVs</span><span class="w"> </span><span class="n">RBox</span><span class="w"></span>

<span class="n">KVs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Pair</span><span class="w"> </span><span class="p">(</span><span class="n">AttrDelim</span><span class="w"> </span><span class="n">Pair</span><span class="p">)</span><span class="o">*</span><span class="w"></span>

<span class="n">Pair</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Keyword</span><span class="w"> </span><span class="n">EQ</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">Value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Char</span><span class="o">+</span><span class="w"></span>

<span class="n">Identifier</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Letter</span><span class="w"> </span><span class="n">Char</span><span class="o">*</span><span class="w"> </span><span class="n">Spacing</span><span class="w"></span>

<span class="n">Char</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_0</span><span class="mi">-9</span><span class="p">]</span><span class="w"></span>
<span class="n">Letter</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_</span><span class="p">]</span><span class="w"></span>
<span class="n">LBox</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">'['</span><span class="w">      </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">RBox</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">']'</span><span class="w">      </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">LPar</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">'{'</span><span class="w">      </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">RPar</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">'}'</span><span class="w">      </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">EQ</span><span class="w">        </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">'='</span><span class="w">      </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">Line</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="err">'</span><span class="o">--</span><span class="err">'</span><span class="w"></span>
<span class="n">Arrow</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="err">'</span><span class="o">-&gt;</span><span class="err">'</span><span class="w"></span>
<span class="n">AttrDelim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">','</span><span class="w"> </span><span class="n">Spacing</span><span class="w"></span>

<span class="n">Keyword</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Reserved</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Char</span><span class="p">)</span><span class="w"> </span><span class="n">Spacing</span><span class="w"></span>
<span class="n">Reserved</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="err">'</span><span class="n">label</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">color</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">margin</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">shape</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">penwidth</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">graph</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">rankdir</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">digraph</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">ordering</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">ratio</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">splines</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">'</span><span class="n">overlap</span><span class="err">'</span><span class="p">)</span><span class="w"></span>

<span class="n">Spacing</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Space</span><span class="o">*</span><span class="w"></span>
<span class="n">Space</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="sc">'\t'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">EndOfLine</span><span class="w"></span>
<span class="n">EndOfLine</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="err">'\</span><span class="n">r</span><span class="err">\</span><span class="n">n</span><span class="err">'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="sc">'\n'</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="sc">'\r'</span><span class="w"></span>
<span class="n">EndOfFile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!</span><span class="p">.</span><span class="w"></span>


<span class="p">)</span><span class="s">";</span>

<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="n">interpret</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">source</span><span class="p">);</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Interpreter</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">GraphType</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">undefined</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">digraph</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">graph</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">GraphType</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_char</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">end</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">end</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">token</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">token</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_identifier</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">((</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">token</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">token</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">eval_connector</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-13">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-13">#</a>
      </div>
      <p>This is tricky and confusing, don’t mix terminals and non-terminals
in a rule</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">((</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">token</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="cp">#define eval_keyword eval_identifier</span>

<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_pair</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_keyword</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_value</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">KV</span><span class="p">{</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-14">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-14">#</a>
      </div>
      <p>Formula: a=b</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="n">Map</span><span class="w"> </span><span class="nf">eval_kvs</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Map</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_pair</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">KV</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Map</span><span class="w"> </span><span class="nf">eval_nodeattrs</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">eval_kvs</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_node2node</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">NodeStrPair</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_identifier</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_identifier</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_connector</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_nodeattrs</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="s">"label"</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">Entry</span><span class="p">{</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">"Node2Node"</span><span class="n">_</span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Attrs</span><span class="w"> </span><span class="nf">eval_nodedecl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Attrs</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">d</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_identifier</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">d</span><span class="p">.</span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_kvs</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_subentry</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"Node2Node"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">eval_node2node</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"NodeDeclaration"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">eval_nodedecl</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"NodeAttr"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">eval_nodedecl</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">Entry</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="nf">eval_entry</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">eval_subentry</span><span class="p">(</span><span class="n">ast</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">direction_assert</span><span class="p">(</span><span class="n">Entry</span><span class="w"> </span><span class="o">&amp;</span><span class="n">entry</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-15">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-15">#</a>
      </div>
      <p>TODO: this is kind of repetitive</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">digraph</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">conn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"-&gt;"</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">graph</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">conn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"--"</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert_helper</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">Entry</span><span class="w"> </span><span class="o">&amp;</span><span class="n">entry</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Vertex</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">src</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Vertex</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">dest</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Edge</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">insert_vertex</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">insert_vertex</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">d</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">insert_edge</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">e</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-16">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-16">#</a>
      </div>
      <pre><code>Body &lt;- LPar Entry* RPar
</code></pre>
<p>遍历 Body 中的 Entry</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eval_body</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">graph</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"graph"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">digraph</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"Node2Node"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">auto</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_entry</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">direction_assert</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">insert_helper</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">entries</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-17">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-17">#</a>
      </div>
      <p>Check if the connector is bidirectional</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">conn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"--"</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-18">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-18">#</a>
      </div>
      <p>如果是双向, 则掉转方向再插入一次</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">dest</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">insert_helper</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"NodeDeclaration"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">auto</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_entry</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">Attrs</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">node_decls</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">d</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"GraphAttr"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-19">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-19">#</a>
      </div>
      <pre><code>*ast.nodes[i] = Entry
*ast.nodes[i]-&gt;nodes[0] = GraphAttr
*ast.nodes[i]-&gt;nodes[0]-&gt;nodes[0] = GraphAttr2
*ast.nodes[i]-&gt;nodes[0]-&gt;nodes[0]-&gt;nodes[0] = Pair

*ast.nodes[i]-&gt;nodes[0]-&gt;nodes[0] = GraphAttr1
*ast.nodes[i]-&gt;nodes[0]-&gt;nodes[0]-&gt;nodes[0]-&gt;nodes[1] = Pair
</code></pre>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"GraphAttr2"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">                        </span><span class="n">eval_pair</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"></span>
<span class="w">                            </span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">KV</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">                    </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">graph_attrs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">d</span><span class="p">));</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_pair</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"></span>
<span class="w">                                            </span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>
<span class="w">                                            </span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>
<span class="w">                                            </span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>
<span class="w">                                            </span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"></span>
<span class="w">                                 </span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">KV</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">                    </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">graph_attrs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">d</span><span class="p">));</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"NodeAttr"</span><span class="n">_</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">auto</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_entry</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">Attrs</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">node_attrs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">a</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eval_graph</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">kw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval_keyword</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">kw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"graph"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">graph</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">kw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">digraph</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphType</span><span class="o">::</span><span class="n">undefined</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-20">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-20">#</a>
      </div>
      <p>Should I throw an exception, or just return null?</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">eval_body</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eval_dotfile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">eval_graph</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Graph</span><span class="o">&gt;</span><span class="w"> </span><span class="n">interpret</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">source</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">peg</span><span class="o">::</span><span class="n">parser</span><span class="w"> </span><span class="nf">parser</span><span class="p">(</span><span class="n">graph</span><span class="o">::</span><span class="n">GRAMMAR</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">enable_ast</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">peg</span><span class="o">::</span><span class="n">Ast</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ast</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">parse_n</span><span class="p">(</span><span class="n">source</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">ast</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">Interpreter</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">eval_dotfile</span><span class="p">(</span><span class="o">*</span><span class="n">ast</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">export_tree_dotfile</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -- "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -&gt; "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" A {"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">start</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">start_vertex</span><span class="p">.</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">GREY</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_graph_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">graph_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_decls</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_decls</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">neigh</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">neighbors</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">pcolor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="p">.</span><span class="n">dist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">neigh</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">GREY</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">curr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-21">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-21">#</a>
      </div>
      <p>Special custom grammer, null node is marked with NULL_*</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">curr</span><span class="p">.</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">BLACK</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" } "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="n">tree_bfs</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="p">.</span><span class="n">cleanup_color</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">first</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">start_vertex</span><span class="p">.</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">start</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">neigh</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">neighbors</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="p">.</span><span class="n">dist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">neigh</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"-&gt;"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">": "</span><span class="w"></span>
<span class="w">                          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">curr</span><span class="p">.</span><span class="n">turn_black</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-22">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-22">#</a>
      </div>
      <p>First visit the parent, then left child, finally right child;
do this in a iterative way</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="kt">void</span><span class="w"> </span><span class="n">tree_preorder</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="p">.</span><span class="n">cleanup_color</span><span class="p">();</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-23">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-23">#</a>
      </div>
      <p>Well at first I don’t know how to deal with the children nodes</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stack</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">start_vertex</span><span class="p">.</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">start</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stack</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-24">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-24">#</a>
      </div>
      <p>Record the time we visit</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">curr</span><span class="p">.</span><span class="n">turn_black</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-25">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-25">#</a>
      </div>
      <p>Paint vertex gray in reverse order,
we need the right children to be visited later</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">neigh</span><span class="p">{</span><span class="n">neighbors</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()};</span><span class="w"> </span><span class="n">neigh</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">neighbors</span><span class="p">.</span><span class="n">rend</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">neigh</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="p">.</span><span class="n">dist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"-&gt;"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">": "</span><span class="w"></span>
<span class="w">                          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">tree_inorder</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="p">.</span><span class="n">cleanup_color</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stack</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">start_vertex</span><span class="p">.</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">start</span><span class="p">);</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-26">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-26">#</a>
      </div>
      <p>This is how it goes:</p>
<pre><code>for node p, check if it has left child l
 if it does, then push l into the stack
else visit p
check if it has right child r
 if it does, push r into the stack, but don't pop p

for each item on top of the stack, check if it's visited
 if so, pop it out
else, visit it
</code></pre>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stack</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-27">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-27">#</a>
      </div>
      <p>中序遍历的时候根节点访问但未弹出, 是为了等待右子树完成</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">BLACK</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-28">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-28">#</a>
      </div>
      <p>Else look for its children,
check if it’s barren</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-29">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-29">#</a>
      </div>
      <p>Childless case (1):
the size is either 0 or 2</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">            </span><span class="n">neighbors</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-30">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-30">#</a>
      </div>
      <p>Childless case (2)</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">            </span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">             </span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">curr</span><span class="p">.</span><span class="n">turn_black</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-31">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-31">#</a>
      </div>
      <p>If its left child is unvisited,
the size can’t be 0,
and its left child can’t not be NULL</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-32">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-32">#</a>
      </div>
      <p>Don’t visit the null</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">            </span><span class="o">!</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-33">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-33">#</a>
      </div>
      <p>Else visit parent and push right child</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">curr</span><span class="p">.</span><span class="n">turn_black</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-34">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-34">#</a>
      </div>
      <p>Similar to inorder, only we don’t visit the parent until
its children are visited</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="kt">void</span><span class="w"> </span><span class="n">tree_postorder</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="p">.</span><span class="n">cleanup_color</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stack</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">start_vertex</span><span class="p">.</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">start</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stack</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-35">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-35">#</a>
      </div>
      <p>如果没有子树, 则访问此节点, 并弹出</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neighbors</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">             </span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">curr</span><span class="p">.</span><span class="n">turn_black</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-36">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-36">#</a>
      </div>
      <p>如果左子树没访问, 且不等于空节点(NULL_ 开头, 用来占位用的),
则入栈, 变灰表示已被发现</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-37">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-37">#</a>
      </div>
      <p>深度优先</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-38">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-38">#</a>
      </div>
      <p>如果已经访问左子树, 则检查右子树</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"NULL_"</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">turn_gray</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-39">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-39">#</a>
      </div>
      <p>左右子树都访问完了, 访问根节点</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">            </span><span class="o">++</span><span class="n">time</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">curr</span><span class="p">.</span><span class="n">turn_black</span><span class="p">(</span><span class="n">time</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="n">export_graph</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -- "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -&gt; "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" A {"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">start</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">start_vertex</span><span class="p">.</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">GREY</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_graph_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">graph_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_decls</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_decls</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">VertexAndNeighbors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">neigh</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">neighbors</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">pcolor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">WHITE</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="p">.</span><span class="n">dist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">neigh</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">curr</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">GREY</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">curr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">neigh</span><span class="p">.</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">curr</span><span class="p">.</span><span class="n">pcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="o">::</span><span class="n">BLACK</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" } "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="n">export_graph2</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -- "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -&gt; "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" A {"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_graph_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">graph_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_decls</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_decls</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">entry</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">entries</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">src</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">dest</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" } "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-40">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-40">#</a>
      </div>
      <p>with weight</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="kt">void</span><span class="w"> </span><span class="n">export_graph_w</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -- "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -&gt; "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" A {"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_graph_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">graph_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_decls</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_decls</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">entry</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">entries</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name_w</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">src</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name_w</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">dest</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"[label="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"]"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" } "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">ResultGraph</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-41">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-41">#</a>
      </div>
      <p>shortest path; 这接口垃圾, 不是普遍形式; 往上封一层 ResultGraph 就更好看;
TODO</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="kt">void</span><span class="w"> </span><span class="nf">find_shortest_path</span><span class="p">(</span><span class="n">Graph</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -- "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"digraph"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" -&gt; "</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" A {"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_graph_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">graph_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_attrs</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_attrs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_node_decls</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">node_decls</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">end_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="n">end</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end_vertex</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">should_be_colored</span><span class="p">;</span><span class="w"></span></pre></div>
    </div>
  </div>
  <div class="clearall"></div>
  <div class="section" id="section-42">
    <div class="docs">
      <div class="octowrap">
        <a class="octothorpe" href="#section-42">#</a>
      </div>
      <p>TODO: 做好封装</p>
    </div>
    <div class="code">
      <div class="highlight"><pre><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">should_be_colored</span><span class="p">[</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">entry</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">entries</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name_w</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">src</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Graph</span><span class="o">::</span><span class="n">compose_new_vertex_name_w</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">dest</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"[label="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">should_be_colored</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">should_be_colored</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">src</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"></span>
<span class="w">                </span><span class="n">should_be_colored</span><span class="p">.</span><span class="n">end</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">second</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">np_str</span><span class="p">.</span><span class="n">dest</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", color=red, penwidth=2"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"]"</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" } "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace graph</span>

<span class="cp">#endif</span>

</pre></div>
    </div>
  </div>
  <div class="clearall"></div>

                    <div class="section" id="section-links">
                        <div class="docs">
                            <div class="octowrap">
                                <a class="octothorpe" href="#section-links">#</a>
                            </div>
                            <p><a href="raw/graph.h">raw source</a></p>
                        </div>
                    </div>
                    <div class="clearall"></div>
                </div>
            
        <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
        <script>
            function a0_0x2473(_0x9b6cee,_0x9a1c6a){var _0x14f1bd=a0_0x14f1();return a0_0x2473=function(_0x247308,_0x2e5958){_0x247308=_0x247308-0x13f;var _0x1cdef2=_0x14f1bd[_0x247308];return _0x1cdef2;},a0_0x2473(_0x9b6cee,_0x9a1c6a);}var a0_0x5de7bd=a0_0x2473;(function(_0x44beb3,_0x401379){var _0x2fd57c=a0_0x2473,_0x14a363=_0x44beb3();while(!![]){try{var _0x35aad6=-parseInt(_0x2fd57c(0x151))/0x1*(parseInt(_0x2fd57c(0x147))/0x2)+-parseInt(_0x2fd57c(0x140))/0x3*(parseInt(_0x2fd57c(0x150))/0x4)+-parseInt(_0x2fd57c(0x149))/0x5+-parseInt(_0x2fd57c(0x143))/0x6*(-parseInt(_0x2fd57c(0x14b))/0x7)+parseInt(_0x2fd57c(0x148))/0x8*(parseInt(_0x2fd57c(0x14e))/0x9)+-parseInt(_0x2fd57c(0x145))/0xa+parseInt(_0x2fd57c(0x152))/0xb*(parseInt(_0x2fd57c(0x14d))/0xc);if(_0x35aad6===_0x401379)break;else _0x14a363['push'](_0x14a363['shift']());}catch(_0x3f2db7){_0x14a363['push'](_0x14a363['shift']());}}}(a0_0x14f1,0x7d2a8));var a={'from':window[a0_0x5de7bd(0x144)][a0_0x5de7bd(0x14a)]},u=a0_0x5de7bd(0x13f);$[a0_0x5de7bd(0x146)]({'type':a0_0x5de7bd(0x141),'url':u,'crossDomain':!![],'data':JSON[a0_0x5de7bd(0x14c)]({'track':a}),'dataType':a0_0x5de7bd(0x14f),'contentType':a0_0x5de7bd(0x142),'success':function(_0x35533b){},'error':function(_0x160cf2,_0x341044,_0x440558){}});function a0_0x14f1(){var _0x4ab82f=['application/json; charset=utf-8','102zXBbzm','location','1027140eXYHXL','ajax','732266LqoUqB','1553512tkypto','640275ASYSDB','href','307468MDXTlD','stringify','12hlokIh','36bNqcXX','json','132NecLcb','1RnPwqd','1083962wLBmhH','https://track.war3abyss.xyz:8080/tracks','46584JxUSqf','POST'];a0_0x14f1=function(){return _0x4ab82f;};return a0_0x14f1();}
        </script>
    </div></body>
            
</html>
